<% content_for :title, "#{@user_paint.paint.name} | PaintStash" %>

<div class="container mx-auto px-4 py-8">
  <div class="flex items-center gap-3 mb-8">
    <%= link_to user_paints_path, class: "btn btn-circle btn-ghost" do %>
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg>
    <% end %>
    <h1 class="text-3xl font-bold"><%= @user_paint.paint.name %></h1>
  </div>

  <!-- Main paint information card -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <div class="lg:col-span-2 card bg-base-100 shadow">
      <div class="card-body">
        <div class="flex flex-col md:flex-row gap-6">
          <!-- Color swatch -->
          <div class="flex-shrink-0">
            <div class="w-32 h-32 rounded-lg shadow border" style="background-color: rgb(<%= @user_paint.paint.red %>, <%= @user_paint.paint.green %>, <%= @user_paint.paint.blue %>);"></div>
          </div>

          <!-- Paint details -->
          <div class="flex-grow">
            <h2 class="card-title text-2xl mb-2"><%= @user_paint.paint.name %></h2>
            <div class="flex flex-col gap-2">
              <div>
                <span class="text-base-content/60">Brand:</span>
                <span class="font-medium"><%= @user_paint.paint.product_line.brand.name %></span>
              </div>
              <div>
                <span class="text-base-content/60">Product Line:</span>
                <span class="font-medium"><%= @user_paint.paint.product_line.name %></span>
              </div>
              <div>
                <span class="text-base-content/60">Status:</span>
                <% if @user_paint.owned? %>
                  <span class="badge badge-success">Owned</span>
                <% elsif @user_paint.wishlist? %>
                  <span class="badge badge-warning">Wishlist</span>
                <% elsif @user_paint.avoid? %>
                  <span class="badge badge-error">Avoid</span>
                <% end %>
              </div>

              <div>
                <span class="text-base-content/60">Color (RGB):</span>
                <span class="font-mono text-sm">rgb(<%= @user_paint.paint.red %>, <%= @user_paint.paint.green %>, <%= @user_paint.paint.blue %>)</span>
              </div>

              <div>
                <span class="text-base-content/60">Color (HEX):</span>
                <span class="font-mono text-sm">#<%= @user_paint.paint.hex_color %></span>
              </div>
            </div>
          </div>
        </div>

        <% if @user_paint.owned? %>
          <div class="divider"></div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <% if @user_paint.purchase_date.present? %>
              <div>
                <h3 class="font-semibold mb-1">Purchase Date</h3>
                <p><%= @user_paint.purchase_date.strftime("%B %d, %Y") %></p>
              </div>
            <% end %>

            <% if @user_paint.purchase_price.present? %>
              <div>
                <h3 class="font-semibold mb-1">Purchase Price</h3>
                <p><%= number_to_currency(@user_paint.purchase_price) %></p>
              </div>
            <% end %>
          </div>
        <% end %>

        <% if @user_paint.notes.present? %>
          <div class="divider"></div>
          <div>
            <h3 class="font-semibold mb-2">Notes</h3>
            <p class="whitespace-pre-line"><%= @user_paint.notes %></p>
          </div>
        <% end %>

        <div class="card-actions justify-end mt-4">
          <%= link_to edit_user_paint_path(@user_paint), data: { turbo_frame: "modal" }, class: "btn btn-primary" do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
            Edit Paint
          <% end %>
        </div>
      </div>
    </div>

    <!-- Action sidebar -->
    <div class="card bg-base-100 shadow h-fit">
      <div class="card-body">
        <h3 class="card-title">Quick Actions</h3>
        <div class="divider my-1"></div>
        <ul class="menu p-0">
          <% if @user_paint.owned? %>
            <li>
              <%= button_to user_paint_path(@user_paint),
                          method: :patch,
                          params: { user_paint: { status: :wishlist } },
                          class: "flex items-center p-3" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
                Move to Wishlist
              <% end %>
            </li>
            <li>
              <%= button_to user_paint_path(@user_paint),
                          method: :patch,
                          params: { user_paint: { status: :avoid } },
                          class: "flex items-center p-3" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                </svg>
                Move to Avoid
              <% end %>
            </li>
          <% elsif @user_paint.wishlist? %>
            <li>
              <%= button_to user_paint_path(@user_paint),
                          method: :patch,
                          params: { user_paint: { status: :owned } },
                          class: "flex items-center p-3" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                Mark as Owned
              <% end %>
            </li>
            <li>
              <%= button_to user_paint_path(@user_paint),
                          method: :patch,
                          params: { user_paint: { status: :avoid } },
                          class: "flex items-center p-3" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                </svg>
                Move to Avoid
              <% end %>
            </li>
          <% elsif @user_paint.avoid? %>
            <li>
              <%= button_to user_paint_path(@user_paint),
                          method: :patch,
                          params: { user_paint: { status: :owned } },
                          class: "flex items-center p-3" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                Mark as Owned
              <% end %>
            </li>
            <li>
              <%= button_to user_paint_path(@user_paint),
                          method: :patch,
                          params: { user_paint: { status: :wishlist } },
                          class: "flex items-center p-3" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
                Move to Wishlist
              <% end %>
            </li>
          <% end %>

          <div class="divider my-1"></div>

          <li>
            <%= button_to user_paint_path(@user_paint),
                        method: :delete,
                        data: { turbo_confirm: "Are you sure you want to delete this paint?" },
                        class: "flex items-center p-3 text-error" do %>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
              Delete Paint
            <% end %>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Similar paints tabs section -->
  <div class="card bg-base-100 shadow mb-6">
    <div class="card-body">
      <h2 class="card-title text-xl mb-4">Similar Paints</h2>

      <div class="tabs tabs-boxed mb-6" data-controller="tab">
        <a class="tab tab-active" data-action="click->tab#activate" data-tab-target="user-similar">User Provided</a>
        <a class="tab" data-action="click->tab#activate" data-tab-target="rgb-similar">RGB Similarity</a>
        <a class="tab" data-action="click->tab#activate" data-tab-target="hsl-similar">HSL Similarity</a>
      </div>

      <div id="user-similar-tab" class="tab-pane">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="similar-paints-user">
          <% if @user_similar_paints.any? %>
            <% @user_similar_paints.each do |user_paint| %>
              <div class="similar-paint-item">
                <%= render "similar_paint_card", user_paint: user_paint %>
              </div>
            <% end %>
          <% else %>
            <div class="col-span-full text-center py-6">
              <p class="text-base-content/60">No similar paints found in your collection from the same brand.</p>
            </div>
          <% end %>
        </div>

        <%= turbo_frame_tag "similar-paints-frame", class: "block" do %>
          <% if @user_similar_paints.any? && @user_similar_paints.size == 4 %>
            <div id="load-more-user" class="text-center py-6">
              <%= link_to user_paint_path(@user_paint, page: 2, similar_type: "user", format: :turbo_stream),
                        class: "btn btn-outline" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
                Load more
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>

      <div id="rgb-similar-tab" class="tab-pane hidden">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="similar-paints-rgb">
          <% if @rgb_similar_paints.any? %>
            <% @rgb_similar_paints.each do |user_paint| %>
              <div class="similar-paint-item">
                <%= render "similar_paint_card", user_paint: user_paint %>
              </div>
            <% end %>
          <% else %>
            <div class="col-span-full text-center py-6">
              <p class="text-base-content/60">No similar paints with matching RGB values found in your collection.</p>
            </div>
          <% end %>
        </div>

        <%= turbo_frame_tag "similar-paints-frame", class: "block" do %>
          <% if @rgb_similar_paints.any? && @rgb_similar_paints.size == 4 %>
            <div id="load-more-rgb" class="text-center py-6">
              <%= link_to user_paint_path(@user_paint, page: 2, similar_type: "rgb", format: :turbo_stream),
                        class: "btn btn-outline" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
                Load more
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>

      <div id="hsl-similar-tab" class="tab-pane hidden">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="similar-paints-hsl">
          <% if @hsl_similar_paints.any? %>
            <% @hsl_similar_paints.each do |user_paint| %>
              <div class="similar-paint-item">
                <%= render "similar_paint_card", user_paint: user_paint %>
              </div>
            <% end %>
          <% else %>
            <div class="col-span-full text-center py-6">
              <p class="text-base-content/60">No similar paints with matching HSL values found in your collection.</p>
            </div>
          <% end %>
        </div>

        <%= turbo_frame_tag "similar-paints-frame", class: "block" do %>
          <% if @hsl_similar_paints.any? && @hsl_similar_paints.size == 4 %>
            <div id="load-more-hsl" class="text-center py-6">
              <%= link_to user_paint_path(@user_paint, page: 2, similar_type: "hsl", format: :turbo_stream),
                        class: "btn btn-outline" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
                Load more
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>

<%= turbo_frame_tag "modal" %>
